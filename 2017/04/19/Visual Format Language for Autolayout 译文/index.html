<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Visual Format Language for Autolayout 译文 | Michaela</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Visual Format Language for Autolayout 译文</h1><a id="logo" href="/.">Michaela</a><p class="description">米粒儿</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-clock-o"> 历史</i></a><a href="/comments_list/"><i class="fa fa-comments"> 留言</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Visual Format Language for Autolayout 译文</h1><div class="post-meta">Apr 19, 2017<span> | </span><span class="category"><a href="/categories/iOS/">iOS</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/04/19/Visual Format Language for Autolayout 译文/" href="/2017/04/19/Visual Format Language for Autolayout 译文/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>Visual Format Language (VFL)使开发者能凭借字符串描述，以比较简洁的方式布局iOS页面；VFL是很强大的布局工具，但是除了官方文档，关于这方面的描述少之又少。<a id="more"></a>整篇文章将会围绕下面这个函数展开：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)constraintsWithVisualFormat:(<span class="built_in">NSString</span> *)format  </div><div class="line">                                 options:(<span class="built_in">NSLayoutFormatOptions</span>)opts  </div><div class="line">                                 metrics:(<span class="built_in">NSDictionary</span> *)metrics  </div><div class="line">                                   views:(<span class="built_in">NSDictionary</span> *)views</div></pre></td></tr></table></figure>
<p>（不得不说这个函数确实比较长）</p>
<h2 id="快速预览"><a href="#快速预览" class="headerlink" title="快速预览"></a>快速预览</h2><p>编译代码写的布局时，相关的View都需要将<code>translatesAutoresizingMaskIntoConstraints</code>设置为NO；的确，实际项目中频繁这样做确实有点乏味，不过，你可以写一个下面这样的category来帮助你：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIView</span> (<span class="title">Autolayout</span>)</span></div><div class="line">+(<span class="keyword">id</span>)autolayoutView;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIView</span> (<span class="title">Autolayout</span>)</span></div><div class="line">+(<span class="keyword">id</span>)autolayoutView</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UIView</span> *view = [<span class="keyword">self</span> new];</div><div class="line">    view.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</div><div class="line">    <span class="keyword">return</span> view;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>实际上，还有很多关于这个category的使用，在这个系列的最后我会一一介绍，同时附上GitHub上相关的代码地址。但目前，我们只需要了解autolayoutView函数就够了。</p>
<p>上述代码对那些需要初始化参数的view并不起作用（特别对于UICollectionView,或UIButton，你必须手动设置translatesAutoresizingMaskIntoConstraints属性），但对于大多数view还是起作用的。记住一点，在autolayout的世界里，initWithFrame:不能再使用了。</p>
<p>###views<br>这个参数是一个NSDictionary，其中包含了layout字符串涉及到所有view。如果想在全局controller中使用或者在其他地方复用这个dictionary，你也可以包含其他view。布局一个view controller，你很可能会多次多次调用constraintsWithVisualFormat函数或者不止一处关于VFL布局的相关陈述。</p>
<p>为了方便，苹果官方提供了一个宏NSDictionaryOfVariableBindings；传入相关的view变量名，返回可以直接使用的dictionary。</p>
<p>因为这个宏专门是为NSLayoutConstraint提供的，实际上它也确实是在NSLayoutConstraint.h中被声明的，就像你不得不为约束使用它一样，关于它有些不可思议的味道。当然，这也不完全对。关于这个宏的等价描述：</p>
<blockquote>
<p>NSDictionaryOfVariableBindings(v1, v2, v3) is equivalent to [NSDictionary dictionaryWithObjectsAndKeys:v1, @”v1”, v2, @”v2”, v3, @”v3”, nil];</p>
</blockquote>
<p>按英文字面意思理解，它创建了一个以变量名为key，以对应变量对象为值的的dictionary。举个例子：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UILabel *<span class="keyword">label</span><span class="bash"> = [UILabel autolayoutView];</span></div><div class="line">NSDictionary *views = NSDictionaryOfVariableBindings(<span class="keyword">label</span><span class="bash">);</span></div></pre></td></tr></table></figure>
<p><code>[views objectForKey:@&quot;label&quot;]</code>会返回<code>label</code>对象，VFL字符串中的<code>[label]</code>将会引用这个对象。</p>
<p>一些开发者声明views的时候并不创建本地变量，而是把所有声明都直接放到属性列表中。这时候是不能使用NSDictionaryOfVariableBindings宏的。这种情况下，你可以手动创建dictionary 。你可以用你喜欢的任何形式作为key，只要它和你在VFL字符串中所使用的能够匹配。</p>
<p>###metrics</p>
<p>这是另外一个dictionary，它的用处是聚合你在布局中需要的所有数字。如<code>views</code>字典，你可以包含多次调用上述函数时会用到的所有十进制数。强烈建议使用metrics字典而非直接在VFL字符串中输入数字，这会使后续的修改更方便。它足够简单，特别是用Objective-C字符串描述的时候：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSDictionary <span class="symbol">*</span>metrics = <span class="meta">@&#123;</span><span class="meta">@"buttonWidth":</span><span class="meta">@200.0&#125;;</span></div></pre></td></tr></table></figure>
<p>上述是一个简单的由一个键和一个以数字对象为值组成的字典。使用这个字典作为<code>metrics</code>参数意味着可以在VFL字符串中写<code>buttonWidth</code>，而后会自动被<code>200.0</code>替代。</p>
<p>###options</p>
<p>对于<code>options</code>的使用，官方文档并没有给出明确的解释。文档指出，一次只能使用options中的一个，但实际情况并不是这样的。例如，对于一个水平方向的布局，最普遍的做法就是上下对齐在VFL中声明的其他view。要做到这一点，你可以使用<code>NSLayoutFormatAlignAllTop | NSLayoutFormatAlignAllBottom</code>作为options。处理的时候会当作为运算来处理，实际也是如此。你只能在直线轴方向上应用options到你的VFL布局中 - 因此，如果做水平方向的布局，可以指定垂直方向的尺寸或者指定options的值，如<code>NSLayoutFormatAlignAllTop</code>或<code>NSLayoutFormatAlignAllCenterY</code>，如果做垂直方向布局，可以指定options如<code>NSLayoutFormatAlignAllLeft</code>或<code>NSLayoutFormatAlignAllCenterX</code></p>
<p>###format</p>
<p>这个是这篇文章的重点，下面是我的关于format的解释和理解。</p>
<p><strong>Views</strong>被命名而且被包含在一个方括号中：<code>[button]</code>指代字典中以button为key的view对象。</p>
<p><strong>The superview</strong>（父视图）用管道符代替：<code>|</code>。<strong>所有的视图都要在创建和布局关联的约束之前添加到父视图中</strong>。如果不这样做，运行时会出现警告。</p>
<p><strong>空隙</strong>用破折号代替<code>-</code></p>
<p>你不需要尝试用一个VFL字符串满足布局的方方面面。所以函数做的事情就是解释VFL，生成约束，然后以数组的形式返回。至少保证有一个约束满足通过，否则VFL字符串就会没有任何意义。</p>
<ul>
<li><code>|-[button]-|</code>：button距离父视图左右边界默认使用标准间隙</li>
<li><code>|-[button]</code>：button距离父视图左边界默认使用标准间隙</li>
<li><code>|[button]</code>：button和父视图左边界对齐</li>
<li><code>-[button]-</code>：无意义。根据哪个视图确定间隙？</li>
</ul>
<p>第二个和第三个例子没有明确的提供布局引擎足够的信息去决定button的宽度-但这样也是没问题的，因为button能够知道基于title，image和font属性得到自己的宽度。这同样适用于label和其他内置控制机制的视图。</p>
<p>通过度量，可以获取更多关于布局的精密控制。间隙的度量可以使用一个十进制数和一个额外的破折号：</p>
<ul>
<li><code>|-30.0-[button]-30.0-|</code>：button距离superview左右边界各30.0点。</li>
</ul>
<p>从减少依赖和重用的角度，你可以用metrics字典中的数值代替：</p>
<ul>
<li><code>|-spacing-[button]-spacing-|</code>：button距离superview左右边界各<code>spacing</code>点，spacing是metrics字典中的一个键key。</li>
</ul>
<p>尺寸度量，通过在view名称后面加上带小括号的数字实现：</p>
<ul>
<li><code>[button(200.0)]</code>：button宽度是200.0点</li>
</ul>
<p>正如前面所说，也可以用metrics字典中的一个key代替：</p>
<ul>
<li><code>[button(buttonWidth)]</code>：button宽度是<code>buttonWidth</code>点，<code>buttonWidth</code>是metrics字典的一个key。</li>
</ul>
<p>值得兴奋的是，也可以用另外一个view的名称代替：</p>
<ul>
<li><code>|-[button1(button2)]-[button2]-|</code>：button1和button2等宽，它们之间有一个标准间隙，button1距离父视图左边界标准间隙，button2距离父视图右边界标准间隙。</li>
</ul>
<p>这个布局使两个button在宽度上均等的铺满父视图。这在设备旋转上比较有用 - 布局会伸缩以适用不同的方向。</p>
<p>所有这些例子默认以从左到右的方式处理水平布局。为了简单，我假设一个从左到右的布局，以从右到左的方式处理方式工作。</p>
<p>对于垂直布局，只需要简单的在VFL字符串前面添加一个<code>V:</code>：</p>
<ul>
<li><code>V:|-[button(50.0)]</code>：button高度为50点，距离父视图顶部标准默认间距。</li>
</ul>
<p>这里又一个例子。我们想要使三个lable都位于view controller底部。三个lable等高等宽，并且能够适应屏幕旋转。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="comment">// Create our three labels using the category method</span></div><div class="line">    </div><div class="line">    <span class="built_in">UILabel</span> *one = [<span class="built_in">UILabel</span> autolayoutView];</div><div class="line">    <span class="built_in">UILabel</span> *two = [<span class="built_in">UILabel</span> autolayoutView];</div><div class="line">    <span class="built_in">UILabel</span> *three = [<span class="built_in">UILabel</span> autolayoutView];</div><div class="line"></div><div class="line">    <span class="comment">// Put some content in there for illustrations</span></div><div class="line">    <span class="built_in">NSInteger</span> labelNumber = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">UILabel</span> *label <span class="keyword">in</span> @[one,two,three])</div><div class="line">    &#123;</div><div class="line">        label.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">        label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</div><div class="line">        label.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d"</span>,labelNumber++];</div><div class="line">        [<span class="keyword">self</span>.view addSubview:label];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// Create the views and metrics dictionaries</span></div><div class="line">    <span class="built_in">NSDictionary</span> *metrics = @&#123;<span class="string">@"height"</span>:@<span class="number">50.0</span>&#125;;</div><div class="line">    <span class="built_in">NSDictionary</span> *views = <span class="built_in">NSDictionaryOfVariableBindings</span>(one,two,three);</div><div class="line">    </div><div class="line">    <span class="comment">// Horizontal layout - note the options for aligning the top and bottom of all views</span></div><div class="line">    [<span class="keyword">self</span>.view addConstraints:[<span class="built_in">NSLayoutConstraint</span> constraintsWithVisualFormat:<span class="string">@"|-[one(two)]-[two(three)]-[three]-|"</span> options:<span class="built_in">NSLayoutFormatAlignAllTop</span> | <span class="built_in">NSLayoutFormatAlignAllBottom</span> metrics:metrics views:views]];</div><div class="line">      </div><div class="line">    <span class="comment">// Vertical layout - we only need one "column" of information because of the alignment options used when creating the horizontal layout</span></div><div class="line">    [<span class="keyword">self</span>.view addConstraints:[<span class="built_in">NSLayoutConstraint</span> constraintsWithVisualFormat:<span class="string">@"V:[one(height)]-|"</span> options:<span class="number">0</span> metrics:metrics views:views]];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>定义上述布局，仅仅用了两条VFL语句。可以尝试手动设置frame和autoresizing masks的方式做同样的效果。</p>
<p>目前为止，所有的例子描述的都是相等性的表述 - 即，button宽度必须为200.当然也可以使用非相等性描述 - 事实证明，这在 OS X比在iOS更有用一些，不管怎样在ios中，用户不可能去改变界面的尺寸，但这里仍然可以找到使用场景。</p>
<p>非相等性描述，即小于等于<code>&lt;=</code>或大于等于<code>&gt;=</code>。使用中如果都不包含，默认假定相等。如果想要明确的表述，可以使用<code>==</code>表示相等：</p>
<ul>
<li><p><code>V:|-(==padding)-[imageView]-&gt;=0-[button]-(==padding)-|</code>：</p>
<ol>
<li>imageView的顶部距离父视图必须为padding</li>
<li>imageView的底部距离button的顶部大于等于0 </li>
<li>button底部距离父视图必须为<code>padding</code></li>
</ol>
</li>
</ul>
<p>上述VFL字符串能确保，父视图收缩之后的高度不小于padding，imageView的高和button的高之和；如果父视图高度大于它们的高度之和，imageView和button将会被分开。</p>
<p>考虑这个场景。又一个发布新闻类文章的app，有一个view用来展示标题，作者，图片和按钮。布局类似如下：</p>
<p><img src="http://commandshift.co.uk/images/autolayout_VFL/headline.png" alt=""></p>
<p>标题可以很长 - 可能会需要很多行来展示。我们可以思考下需要哪些约束才能达到预期效果？</p>
<ul>
<li>父视图header view为固定宽度</li>
<li>header view能够调整高度适配内容</li>
<li>标题Headline底部距离作者信息栏Author不小于0</li>
<li>Headline右边缘在image左边界</li>
<li>如果需要，Headline 文本可多行显示</li>
<li>headline的高度如果大于button和image之和，button和image之间的间隙应该增加。</li>
<li>headline的高度如果小于button和image之和，headline和author之间的间隔应该增加。</li>
</ul>
<p>在autolayout的世界里，我们可以看到是单调乏味的frame计算和font sizeing函数调用。欢迎来到未来：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    UIView *headerView = [UIView autolayoutView];</div><div class="line">    headerView.backgroundColor = [UIColor lightGrayColor];</div><div class="line">    [self.view <span class="string">addSubview:</span>headerView];</div><div class="line">    </div><div class="line">    UILabel *headline = [UILabel autolayoutView];</div><div class="line">    headline.font = [UIFont <span class="string">systemFontOfSize:</span><span class="number">30.0</span>];</div><div class="line">    headline.numberOfLines = <span class="number">0</span>;</div><div class="line">    headline.preferredMaxLayoutWidth = <span class="number">125.0</span>; <span class="comment">// This is necessary to allow the label to use multi-line text properly</span></div><div class="line">    headline.backgroundColor = [UIColor yellowColor]; <span class="comment">// So we can see the sizing</span></div><div class="line">    headline.text = @<span class="string">"Kitten kills again"</span>;</div><div class="line">    [headerView <span class="string">addSubview:</span>headline];</div><div class="line">    </div><div class="line">    UILabel *byline = [UILabel autolayoutView];</div><div class="line">    byline.font = [UIFont <span class="string">systemFontOfSize:</span><span class="number">14.0</span>];</div><div class="line">    byline.backgroundColor = [UIColor greenColor]; <span class="comment">// So we can see the sizing</span></div><div class="line">    byline.text = @<span class="string">"Paws McGruff"</span>;</div><div class="line"></div><div class="line">    [headerView <span class="string">addSubview:</span>byline];</div><div class="line">    </div><div class="line">    UIImageView *imageView = [UIImageView autolayoutView];</div><div class="line">    imageView.contentMode = UIViewContentModeScaleAspectFit;</div><div class="line">    [headerView <span class="string">addSubview:</span>imageView];</div><div class="line">    </div><div class="line">    <span class="comment">// Lovely image loaded for example purposes</span></div><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        UIImage *kitten = [UIImage <span class="string">imageWithData:</span>[NSData <span class="string">dataWithContentsOfURL:</span>[NSURL <span class="string">URLWithString:</span>@<span class="string">"http://placekitten.com/150/150"</span>] <span class="string">options:</span><span class="number">0</span> <span class="string">error:</span>nil]];</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            imageView.image = kitten;</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    UIButton *button = [UIButton <span class="string">buttonWithType:</span>UIButtonTypeRoundedRect];</div><div class="line">    button.translatesAutoresizingMaskIntoConstraints = NO;</div><div class="line">    [button <span class="string">setTitle:</span>@<span class="string">"Button"</span> <span class="string">forState:</span>UIControlStateNormal];</div><div class="line">    [headerView <span class="string">addSubview:</span>button];</div><div class="line">    </div><div class="line">    <span class="comment">// Layout</span></div><div class="line">    </div><div class="line">    NSDictionary *views = NSDictionaryOfVariableBindings(headerView,headline,byline,imageView,button);</div><div class="line">    NSDictionary *metrics = @&#123;@<span class="string">"imageEdge"</span>:@<span class="number">150.0</span>,@<span class="string">"padding"</span>:@<span class="number">15.0</span>&#125;;</div><div class="line">    </div><div class="line">    <span class="comment">// Header view fills the width of its superview</span></div><div class="line">    [self.view <span class="string">addConstraints:</span>[NSLayoutConstraint <span class="string">constraintsWithVisualFormat:</span>@<span class="string">"|[headerView]|"</span> <span class="string">options:</span><span class="number">0</span> <span class="string">metrics:</span>metrics <span class="string">views:</span>views]];</div><div class="line">    <span class="comment">// Header view is pinned to the top of the superview</span></div><div class="line">    [self.view <span class="string">addConstraints:</span>[NSLayoutConstraint <span class="string">constraintsWithVisualFormat:</span>@<span class="string">"V:|[headerView]"</span> <span class="string">options:</span><span class="number">0</span> <span class="string">metrics:</span>metrics <span class="string">views:</span>views]];</div><div class="line">    </div><div class="line">    <span class="comment">// Headline and image horizontal layout</span></div><div class="line">    [headerView <span class="string">addConstraints:</span>[NSLayoutConstraint <span class="string">constraintsWithVisualFormat:</span>@<span class="string">"|-padding-[headline]-padding-[imageView(imageEdge)]-padding-|"</span> <span class="string">options:</span><span class="number">0</span> <span class="string">metrics:</span>metrics <span class="string">views:</span>views]];</div><div class="line">    </div><div class="line">    <span class="comment">// Headline and byline vertical layout - spacing at least zero between the two</span></div><div class="line">    [headerView <span class="string">addConstraints:</span>[NSLayoutConstraint <span class="string">constraintsWithVisualFormat:</span>@<span class="string">"V:|-padding-[headline]-&gt;=0-[byline]-padding-|"</span> <span class="string">options:</span>NSLayoutFormatAlignAllLeft <span class="string">metrics:</span>metrics <span class="string">views:</span>views]];</div><div class="line">    </div><div class="line">    <span class="comment">// Image and button vertical layout - spacing at least 15 between the two</span></div><div class="line">    [headerView <span class="string">addConstraints:</span>[NSLayoutConstraint <span class="string">constraintsWithVisualFormat:</span>@<span class="string">"V:|-padding-[imageView(imageEdge)]-&gt;=padding-[button]-padding-|"</span> <span class="string">options:</span>NSLayoutFormatAlignAllLeft | NSLayoutFormatAlignAllRight <span class="string">metrics:</span>metrics <span class="string">views:</span>views]];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意，在一个真正的app里，不能这样去设置text和image，应该在单独的设置函数里去设置。这里使用，仅仅是为了保证代码简单。</p>
<p>代码的运行结果如下：<br><img src="http://commandshift.co.uk/images/autolayout_VFL/shortheadline.png" alt=""></p>
<p>编辑认为不够引人注目。输入一个更长的标题，代码没有做任何改变：</p>
<p><img src="http://commandshift.co.uk/images/autolayout_VFL/longheadline.png" alt=""></p>
<p>额外地，如果在一个设置新标题的的block动画里调用<code>layoutIfNeeded</code>，headline视图会动态的切换到新的布局。</p>
<p>最后一点可以添加到VFL字符串的是约束优先级。诚实的讲，至今我还没有使用过优先级，所以我不想写太多关于这方面的内容。我认为它对于OS X更有用。优先级是介于0和1000之间的float浮点数。苹果官方建议使用方便阅读的UILayoutPriority枚举。约束优先级1000（默认）表示必须满足-如果和有同样优先级的约束冲突，运行时会有警告。低优先级约束会尽量满足或者接近设置的那个约束值。</p>
<p>你可以在VFL字符串中在约束值后面使用<code>@</code>字符添加约束优先级：</p>
<ul>
<li><code>&quot;|[button(==200@750)]-[label]|&quot;</code>：button的宽度为200点，优先级为750.</li>
<li><code>&quot;|-30.0@200-[label]&quot;</code>：label距离父视图右边界30点，优先级为200.</li>
</ul>
<p>如果打算使用枚举数值，可以将优先级添加到metrics字典中：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSDictionary *metrics = @&#123;@<span class="string">"lowPriority"</span>:@(UILayoutPriorityDefaultLow)&#125;;</div><div class="line"></div><div class="line">[self.view <span class="string">addConstraints:</span>[NSLayoutConstraint <span class="string">constraintsWithVisualFormat:</span>@<span class="string">"|-30.0@lowPriority-[label]"</span> <span class="string">options:</span><span class="number">0</span> <span class="string">metrics:</span>metrics <span class="string">views:</span>NSDictionaryOfVariableBindings(label)];</div></pre></td></tr></table></figure>
<p>###总结<br>我们已经深入的了解了官方文档关于VFL的很多细节，并且举了一些真实的例子方便理解。现在你可以更聪明的使用VFL了，动态的构建VFL字符串，这将会给予你更大的布局的灵活性。</p>
<p>虽然如此，这里也有一些<strong>局限性</strong> - 你不能设置一个视图自身的宽高比，也不能剧中对齐父视图。为了做到这些，你需要创建一些独特的约束，这中方式我会在这个系列的下个部分介绍。我也会分享一些category 方法方便简化一些常用的约束操作。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.devheminghui.cn/2017/04/19/Visual Format Language for Autolayout 译文/" data-id="cj2a8gg0j000ubcfyb3pcgkd5" class="article-share-link">分享到</a><div class="tags"><a href="/tags/布局约束/">布局约束</a></div><div class="post-nav"><a href="/2017/04/05/构造器一两点总结/" class="next">构造器一两点总结</a></div><div id="disqus_thread"><script>var disqus_shortname = 'devheminghui';
var disqus_identifier = '2017/04/19/Visual Format Language for Autolayout 译文/';
var disqus_title = 'Visual Format Language for Autolayout 译文';
var disqus_url = 'http://www.devheminghui.cn/2017/04/19/Visual Format Language for Autolayout 译文/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//devheminghui.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.devheminghui.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网站/">网站</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/动画/" style="font-size: 15px;">动画</a> <a href="/tags/iOS-10/" style="font-size: 15px;">iOS 10</a> <a href="/tags/支付/" style="font-size: 15px;">支付</a> <a href="/tags/Xcode-8/" style="font-size: 15px;">Xcode 8</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/Objective-C/" style="font-size: 15px;">Objective-C</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/布局约束/" style="font-size: 15px;">布局约束</a> <a href="/tags/JavaScriptCore/" style="font-size: 15px;">JavaScriptCore</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/总结/" style="font-size: 15px;">总结</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/19/Visual Format Language for Autolayout 译文/">Visual Format Language for Autolayout 译文</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/05/构造器一两点总结/">构造器一两点总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/Git使用实录/">Git使用实录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/22/布局约束优先级-初探/">布局约束优先级-初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/年前网站打理/">年终</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/JS交互之JavaScriptCore/">JS交互之JavaScriptCore</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/2016-09-24/">如何使用hexo搭建个人站</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/2016-09-23/">动画时间</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/2016-09-21/">Carthage包管理体验及常见swift库</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/2016-09-20/">Xcode 8 新特性</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//devheminghui.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=0"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.objccn.io" title="ObjC中国" target="_blank">ObjC中国</a><ul></ul><a href="http://nshipster.cn" title="NSHipster中文版" target="_blank">NSHipster中文版</a><ul></ul><a href="https://github.com/GHeminghui" title="Github" target="_blank">Github</a><ul></ul><a href="http://wiki.jikexueyuan.com" title="资料wiki" target="_blank">资料wiki</a><ul></ul><a href="http://acm.sdibt.edu.cn" title="算法online平台" target="_blank">算法online平台</a><ul></ul><a href="https://www.haomwei.com/technology/maupassant-hexo.html" title="个人站入门" target="_blank">个人站入门</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Michaela.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>